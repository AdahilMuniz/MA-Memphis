#!/usr/bin/env python3
import sys
from argparse import ArgumentParser
from os import getenv
from os.path import exists

def scenario_build(platform_path, testcase_folder, scenario_file):
	sys.path.append(platform_path+"/build_env/modules")
	from scenario import Scenario
	scenario = Scenario(platform_path, testcase_folder, scenario_file)
	scenario.copy()
	scenario.build()

if __name__ == "__main__":
	ENV_PLATFORM_PATH = "MA_MEMPHIS_PATH"
	PLATFORM_PATH = getenv(ENV_PLATFORM_PATH)
	if PLATFORM_PATH is None:
		sys.exit("ERROR: "+ENV_PLATFORM_PATH+" not defined.")

	parser = ArgumentParser(description="MA-Memphis scenario generator.")
	parser.add_argument('testcase_folder', help="Path to folder where a testcase is built")
	parser.add_argument('scenario', help="Scenario description file")
	args = parser.parse_args()

	testcase_folder = args.testcase_folder
	scenario_file = args.scenario

	testcase_name = testcase_folder.split("/")
	testcase_name = testcase_name[len(testcase_name) - 1]
	testcase_file = testcase_folder+"/"+ testcase_name+".yaml"

	if not exists(testcase_file):
		sys.exit("ERROR: Testcase "+testcase_file+" not found.")

	try:
		scenario_build(PLATFORM_PATH, testcase_folder, scenario_file)
	except Exception as ex:
		sys.exit("\nERROR: {}".format(ex))
