#!/usr/bin/env python3
import sys
from argparse import ArgumentParser
from os import getenv
from os.path import exists

def testcase_build(platform_path, testcase_file):
	sys.path.append(platform_path+"/build_env/modules")
	from testcase import Testcase
	tc = Testcase(platform_path, testcase_file)
	tc.copy()
	tc.build()

if __name__ == "__main__":
	ENV_PLATFORM_PATH = "MA_MEMPHIS_PATH"
	PLATFORM_PATH = getenv(ENV_PLATFORM_PATH)
	if PLATFORM_PATH is None:
		sys.exit("ERROR: "+ENV_PLATFORM_PATH+" not defined.")

	parser = ArgumentParser(description="MA-Memphis hardware generator.")
	parser.add_argument('testcase', help="Testcase description file")
	args = parser.parse_args()

	testcase_file = args.testcase
	if not exists(testcase_file):
		sys.exit("ERROR: Testcase "+testcase_file+" not found.")

	testcase_build(PLATFORM_PATH, testcase_file)
